<app-header></app-header>

<div class="bg-[#0a0c1a] min-h-screen text-white px-4 md:px-8 py-8">

  <!-- Title -->
  <h2 class="text-2xl font-semibold mb-1">Monitor Overview</h2>
  <p class="text-slate-400 text-sm mb-6">
    Real-time performance tracking across all your endpoints
  </p>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex items-center justify-center min-h-[400px]">
    <div class="text-center">
      <i class="fa-solid fa-spinner fa-spin text-4xl text-blue-400 mb-4"></i>
      <p class="text-gray-400">Loading monitors...</p>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage && !isLoading" class="mb-4 p-4 bg-red-500/10 border border-red-500/30 rounded-lg">
    <p class="text-red-400">{{ errorMessage }}</p>
  </div>

  <!-- Cards Container -->
  <div *ngIf="!isLoading && analyticsData" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-8">
    <div
      *ngFor="let card of cards"
      class="bg-slate-900/60 border border-slate-700/40 rounded-xl p-6 shadow-lg 
             transition-all duration-300 cursor-pointer
             hover:shadow-blue-500/40 hover:-translate-y-1 hover:bg-slate-900/80">

      <!-- Header Row -->
      <div class="flex justify-between items-start mb-4">
        <!-- ICON -->
        <i [ngClass]="card.icon + ' ' + card.iconColor + ' text-2xl'"></i>

        <!-- Change Value -->
        <span [ngClass]="card.changeColor" class="text-sm font-semibold">
          {{ card.change }}
        </span>
      </div>

      <!-- Value -->
      <p class="text-4xl font-bold">{{ card.value }}</p>

      <!-- Label -->
      <p class="text-slate-400 mt-1 text-sm">{{ card.label }}</p>
    </div>
  </div>

  <!-- Additional Card Widgets Grid -->
  <div *ngIf="!isLoading && analyticsData" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 auto-rows-fr">
    <app-card-widget *ngFor="let widget of cardWidgets" [data]="widget" class="h-full"></app-card-widget>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && analyticsData && analyticsData.monitors.length === 0" class="text-center py-12">
    <i class="fa-solid fa-inbox text-6xl text-gray-600 mb-4"></i>
    <p class="text-gray-400 text-lg">No monitors configured yet</p>
    <p class="text-gray-500 text-sm mt-2">Click the + button to add your first monitor</p>
  </div>

  <!-- Glowing Add Button -->
  <button
    class="fixed bottom-6 right-6 w-14 h-14 bg-purple-600 text-white rounded-full 
           flex items-center justify-center text-2xl shadow-lg shadow-purple-500/50
           transition-transform transform hover:scale-110 hover:shadow-purple-400/70 z-40"
    (click)="addNewWidget()"
  >
    <i class="fa-solid fa-plus"></i>
  </button>

</div>

<!-- Add Monitor Popup -->
<div
  *ngIf="showPopup"
  class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-y-auto"
  (click)="closePopup()">
  <div 
    class="bg-slate-900 rounded-xl w-11/12 sm:w-[600px] max-w-2xl p-6 shadow-2xl border border-slate-700 my-8"
    (click)="$event.stopPropagation()">
    
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-xl font-semibold text-white">Add New Monitor</h3>
      <button class="text-slate-400 hover:text-white text-2xl" (click)="closePopup()">&times;</button>
    </div>

    <!-- Error Message -->
    <div *ngIf="submitError" class="mb-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg">
      <p class="text-red-400 text-sm">{{ submitError }}</p>
    </div>

    <!-- Form -->
    <form [formGroup]="monitorForm" (ngSubmit)="submitForm()" class="flex flex-col gap-4">

      <!-- Monitor Name -->
      <div>
        <label class="text-slate-400 text-sm mb-1 block">Monitor Name *</label>
        <input
          type="text"
          formControlName="name"
          placeholder="Production API"
          class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
        />
        <p *ngIf="monitorForm.get('name')?.invalid && monitorForm.get('name')?.touched" class="text-red-400 text-xs mt-1">
          Monitor name is required
        </p>
      </div>

      <!-- Service URL -->
      <div>
        <label class="text-slate-400 text-sm mb-1 block">Service URL *</label>
        <input
          type="text"
          formControlName="url"
          placeholder="https://api.example.com"
          class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
        />
        <p *ngIf="monitorForm.get('url')?.invalid && monitorForm.get('url')?.touched" class="text-red-400 text-xs mt-1">
          Service URL is required
        </p>
      </div>

      <!-- Monitor Type -->
      <div>
        <label class="text-slate-400 text-sm mb-1 block">Monitor Type *</label>
        <select
          formControlName="type"
          class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
          <option value="website">Website</option>
          <option value="api">API</option>
        </select>
      </div>

      <!-- API Type (only for API monitors) -->
      <div *ngIf="isApiType">
        <label class="text-slate-400 text-sm mb-1 block">HTTP Method *</label>
        <select
          formControlName="apiType"
          class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
          <option value="GET">GET</option>
          <option value="POST">POST</option>
          <option value="PUT">PUT</option>
          <option value="DELETE">DELETE</option>
        </select>
      </div>

      <!-- Refresh Time -->
      <div>
        <label class="text-slate-400 text-sm mb-1 block">Refresh Time (seconds) *</label>
        <input
          type="number"
          formControlName="refreshTime"
          min="5"
          placeholder="60"
          class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
        />
        <p *ngIf="monitorForm.get('refreshTime')?.invalid && monitorForm.get('refreshTime')?.touched" class="text-red-400 text-xs mt-1">
          Refresh time must be at least 5 seconds
        </p>
      </div>

      <!-- Occurrences -->
      <div>
        <label class="text-slate-400 text-sm mb-1 block">Occurrences</label>
        <input
          type="number"
          formControlName="occurances"
          min="0"
          placeholder="0"
          class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
        />
        <p class="text-slate-500 text-xs mt-1">Number of times to ping (0 = unlimited)</p>
      </div>

      <!-- Parallel Limit -->
      <div>
        <label class="text-slate-400 text-sm mb-1 block">Parallel Limit</label>
        <input
          type="number"
          formControlName="parallelLimit"
          min="1"
          placeholder="1"
          class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
        />
        <p class="text-slate-500 text-xs mt-1">Maximum parallel requests</p>
      </div>

      <!-- Headers (only for API monitors) -->
      <div *ngIf="isApiType">
        <label class="text-slate-400 text-sm mb-1 block">Headers (JSON) *</label>
        <textarea
          formControlName="headers"
          rows="4"
          placeholder='{"Content-Type": "application/json"}'
          class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500 font-mono text-sm"
        ></textarea>
        <p *ngIf="monitorForm.get('headers')?.invalid && monitorForm.get('headers')?.touched" class="text-red-400 text-xs mt-1">
          Valid JSON is required
        </p>
      </div>

      <!-- Request Body (only for API monitors) -->
      <div *ngIf="isApiType">
        <label class="text-slate-400 text-sm mb-1 block">Request Body (JSON) *</label>
        <textarea
          formControlName="requestBody"
          rows="4"
          placeholder='{"key": "value"}'
          class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500 font-mono text-sm"
        ></textarea>
        <p *ngIf="monitorForm.get('requestBody')?.invalid && monitorForm.get('requestBody')?.touched" class="text-red-400 text-xs mt-1">
          Valid JSON is required
        </p>
      </div>

      <!-- Submit Button -->
      <div class="flex gap-3 mt-4">
        <button
          type="button"
          (click)="closePopup()"
          class="flex-1 px-4 py-3 bg-slate-700 hover:bg-slate-600 text-white font-semibold rounded-lg transition-colors">
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="isSubmitting || monitorForm.invalid"
          class="flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold rounded-lg shadow-lg transition-colors">
          <span *ngIf="!isSubmitting">Add Monitor</span>
          <span *ngIf="isSubmitting" class="flex items-center justify-center gap-2">
            <i class="fa-solid fa-spinner fa-spin"></i>
            Adding...
          </span>
        </button>
      </div>
    </form>

  </div>
</div>
